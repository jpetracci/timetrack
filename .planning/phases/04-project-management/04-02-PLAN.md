---
phase: 04-project-management
plan: 02
type: execute
wave: 2
depends_on: ["01"]
files_modified:
  - lib/models/project.dart
  - lib/state/projects_state.dart
  - lib/ui/screens/projects_screen.dart
  - lib/ui/screens/project_details_screen.dart
  - lib/ui/screens/archived_projects_screen.dart
autonomous: false

must_haves:
  truths:
    - "User can archive a project to hide it from the main list"
    - "User can view archived projects and restore them"
    - "Archived projects remain available in history and details"
  artifacts:
    - path: "lib/models/project.dart"
      provides: "Persistent isArchived flag with safe defaults"
    - path: "lib/ui/screens/archived_projects_screen.dart"
      provides: "Archive management list with restore actions"
    - path: "lib/ui/screens/projects_screen.dart"
      provides: "Filtered active projects list with archive entry point"
  key_links:
    - from: "lib/ui/screens/project_details_screen.dart"
      to: "lib/state/projects_state.dart"
      via: "archiveProject/unarchiveProject"
      pattern: "archiveProject|unarchiveProject"
    - from: "lib/ui/screens/projects_screen.dart"
      to: "lib/ui/screens/archived_projects_screen.dart"
      via: "Navigator.push"
      pattern: "ArchivedProjectsScreen"
---

<objective>
Add project archival and archive management UI.

Purpose: Let users hide inactive projects while keeping their history accessible.
Output: Archived flag in Project model, archive/unarchive mutations, and archive list screen.
</objective>

<execution_context>
@/Users/joel/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/joel/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-project-management/04-RESEARCH.md

@lib/models/project.dart
@lib/state/projects_state.dart
@lib/ui/screens/projects_screen.dart
@lib/ui/screens/project_details_screen.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add archived flag and controller mutations</name>
  <files>lib/models/project.dart, lib/state/projects_state.dart</files>
  <action>
Extend `Project` with `bool isArchived` (default false). Update constructor, `copyWith`, `toJson`, and `fromJson` to support the new field and handle missing values safely for existing data.

Add `archiveProject(projectId)` and `unarchiveProject(projectId)` to `ProjectsController` to update the matching project immutably and persist the updated list. Keep `createdAt` and other fields unchanged.
  </action>
  <verify>flutter analyze</verify>
  <done>Projects can be marked archived/unarchived and the state persists after reload.</done>
</task>

<task type="auto">
  <name>Task 2: Wire archive UI and archive management screen</name>
  <files>lib/ui/screens/projects_screen.dart, lib/ui/screens/project_details_screen.dart, lib/ui/screens/archived_projects_screen.dart</files>
  <action>
Filter the main projects list to show only `!project.isArchived`. Add an "Archived" action in the Projects screen header (e.g., IconButton near the "Projects" title) that navigates to `ArchivedProjectsScreen`.

Create `ArchivedProjectsScreen` listing archived projects with name/tags and actions: "Restore" (calls `unarchiveProject`) and "View" (opens `ProjectDetailsScreen`). In `ProjectDetailsScreen`, add an Archive/Unarchive button that toggles the archived state. Prevent archiving while a timer is running for the project; show a snackbar if blocked. If a project is archived from details, navigate back to the main list to avoid showing it in the active list.
  </action>
  <verify>flutter analyze</verify>
  <done>Archived projects are hidden from the main list and can be restored from an archive management screen.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Project archival flow and archive management screen</what-built>
  <how-to-verify>
    1) Open a projectâ€™s details screen and archive it.
    2) Confirm it disappears from the main list and appears in Archived Projects.
    3) Restore it and confirm it returns to the main list.
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
- `flutter analyze`
- Manual smoke check: archive, list hides, restore returns
</verification>

<success_criteria>
- Archive/unarchive state persists and is reflected in the list
- Archived projects are accessible via a dedicated screen
- Archiving is blocked for running projects with clear feedback
</success_criteria>

<output>
After completion, create `.planning/phases/04-project-management/04-02-SUMMARY.md`
</output>
