---
phase: 04-project-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/ui/screens/projects_screen.dart
  - lib/widgets/project_card.dart
  - lib/ui/screens/project_details_screen.dart
  - lib/widgets/project_edit_sheet.dart
  - lib/state/projects_state.dart
  - lib/state/timer_controller.dart
autonomous: false

must_haves:
  truths:
    - "User can open a project details screen from the projects list"
    - "User can edit project name and tags from the details screen"
    - "User can delete a project with confirmation and it disappears from the list"
  artifacts:
    - path: "lib/ui/screens/project_details_screen.dart"
      provides: "Project detail view with edit/delete actions"
    - path: "lib/widgets/project_edit_sheet.dart"
      provides: "Bottom-sheet form for editing project name/tags"
    - path: "lib/state/projects_state.dart"
      provides: "updateProject and deleteProject mutations with persistence"
    - path: "lib/state/timer_controller.dart"
      provides: "removeEntriesForProject mutation to clean history"
  key_links:
    - from: "lib/ui/screens/projects_screen.dart"
      to: "lib/ui/screens/project_details_screen.dart"
      via: "Navigator.push"
      pattern: "Navigator\.push\(.*ProjectDetailsScreen"
    - from: "lib/widgets/project_edit_sheet.dart"
      to: "lib/state/projects_state.dart"
      via: "ProjectsController.updateProject"
      pattern: "updateProject\("
    - from: "lib/ui/screens/project_details_screen.dart"
      to: "lib/state/timer_controller.dart"
      via: "removeEntriesForProject before delete"
      pattern: "removeEntriesForProject"
---

<objective>
Enable project detail access with edit and delete flows.

Purpose: Let users manage project metadata and remove projects cleanly.
Output: Project details screen, edit sheet, controller mutations, and delete cleanup flow.
</objective>

<execution_context>
@/Users/joel/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/joel/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-project-management/04-RESEARCH.md

@lib/ui/screens/projects_screen.dart
@lib/widgets/project_card.dart
@lib/widgets/new_project_sheet.dart
@lib/state/projects_state.dart
@lib/state/timer_controller.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add project details screen with edit sheet</name>
  <files>lib/ui/screens/projects_screen.dart, lib/widgets/project_card.dart, lib/ui/screens/project_details_screen.dart, lib/widgets/project_edit_sheet.dart, lib/state/projects_state.dart</files>
  <action>
Create `ProjectDetailsScreen` showing project name, tags, and created date plus an Edit action. Add a small details icon button on each `ProjectCard` (keep tap for start/stop) that navigates to the details screen via `Navigator.push` with `MaterialPageRoute`.

Create `ProjectEditSheet` as a bottom sheet with prefilled name/tags controllers, matching validation from `NewProjectSheet`. On submit, call `ProjectsController.updateProject(projectId, name, tags)`; update project immutably (no in-place list mutation), persist with `LocalStorage.saveProjects`, and close the sheet. Show a snackbar on save success or error and check `context.mounted` after awaits.
  </action>
  <verify>flutter analyze</verify>
  <done>User can open details from a project card and edit name/tags; changes persist and display in the list.</done>
</task>

<task type="auto">
  <name>Task 2: Implement delete project flow with entry cleanup</name>
  <files>lib/ui/screens/project_details_screen.dart, lib/state/projects_state.dart, lib/state/timer_controller.dart</files>
  <action>
Add `ProjectsController.deleteProject(projectId)` to remove the project, clear `activeProjectId` if it matches, and persist. Add `TimerController.removeEntriesForProject(projectId)` to filter out matching entries and persist via `LocalStorage.saveEntries`.

In `ProjectDetailsScreen`, add a Delete button that opens an `AlertDialog` confirmation. On confirm: if the timer is running for this project, call `timerController.stop()` first, then `removeEntriesForProject(projectId)`, then `deleteProject(projectId)`. After deletion, pop back to `ProjectsScreen` and show a snackbar confirmation. Guard async UI actions with `context.mounted`.
  </action>
  <verify>flutter analyze</verify>
  <done>Deleting a project removes it from the list, clears its entries, and stops the timer if it was active.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Project details screen with edit and delete flows</what-built>
  <how-to-verify>
    1) Run the app and open a projectâ€™s details screen from the list.
    2) Edit the name and tags, save, and confirm the list updates.
    3) Delete the project, confirm the dialog, and verify it disappears.
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
- `flutter analyze`
- Manual smoke check: project details open, edit saves, delete removes project
</verification>

<success_criteria>
- Project details are reachable from the list and show edit/delete actions
- Editing updates name/tags and persists after reload
- Deleting removes the project and related entries and clears running timers
</success_criteria>

<output>
After completion, create `.planning/phases/04-project-management/04-01-SUMMARY.md`
</output>
