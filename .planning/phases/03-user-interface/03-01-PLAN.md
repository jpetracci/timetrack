---
phase: 03-user-interface
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/main.dart
  - lib/ui/home_screen.dart
  - lib/ui/screens/projects_screen.dart
  - lib/ui/screens/reports_screen.dart
  - lib/ui/screens/settings_screen.dart
  - lib/ui/widgets/timer_header.dart
  - lib/state/timer_state.dart
  - lib/state/timer_controller.dart
autonomous: true

must_haves:
  truths:
    - "Active project and timer appear in a sticky header above the list"
    - "Timer controls stay visible while scrolling projects"
    - "Bottom tabs switch between Projects, Reports, and Settings"
    - "App launches into a usable Projects screen within 2 seconds"
  artifacts:
    - path: "lib/ui/home_screen.dart"
      provides: "Single Scaffold with bottom navigation and tab pages"
    - path: "lib/ui/screens/projects_screen.dart"
      provides: "Projects view with pinned timer header and list"
    - path: "lib/ui/widgets/timer_header.dart"
      provides: "Header showing active project, time, and quick controls"
    - path: "lib/ui/screens/reports_screen.dart"
      provides: "Reports placeholder screen"
    - path: "lib/ui/screens/settings_screen.dart"
      provides: "Settings placeholder screen"
  key_links:
    - from: "lib/ui/home_screen.dart"
      to: "lib/ui/screens/projects_screen.dart"
      via: "IndexedStack pages"
      pattern: "IndexedStack"
    - from: "lib/ui/screens/projects_screen.dart"
      to: "lib/ui/widgets/timer_header.dart"
      via: "SliverPersistentHeader delegate"
      pattern: "SliverPersistentHeader"
    - from: "lib/ui/widgets/timer_header.dart"
      to: "lib/state/timer_controller.dart"
      via: "Riverpod ref.watch/select"
      pattern: "ref\.watch"
---

<objective>
Deliver a bottom-tabbed main shell with a pinned timer header so the active project and controls stay prominent during scrolling.

Purpose: Establish the Phase 3 UX foundation with clear navigation and timer prominence.
Output: New tabbed home layout, projects screen with sticky header, and placeholder screens for reports and settings.
</objective>

<execution_context>
@/Users/joel/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/joel/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-user-interface/03-CONTEXT.md
@.planning/phases/03-user-interface/03-RESEARCH.md
@lib/main.dart
@lib/ui/home_screen.dart
@lib/state/timer_controller.dart
@lib/state/timer_state.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build tabbed shell and screen scaffolds</name>
  <files>
    lib/ui/home_screen.dart
    lib/ui/screens/projects_screen.dart
    lib/ui/screens/reports_screen.dart
    lib/ui/screens/settings_screen.dart
  </files>
  <action>
    Replace the current HomeScreen with a single top-level Scaffold that uses a Material 3 NavigationBar (ThemeData.useMaterial3 is true) and an IndexedStack for tab pages. Create Projects/Reports/Settings screens under lib/ui/screens and render them from the IndexedStack. Reports/Settings should be read-only placeholders with titles and empty states. Avoid nested Scaffolds in tab screens; only HomeScreen owns the Scaffold.
  </action>
  <verify>flutter analyze</verify>
  <done>Bottom tabs appear with three destinations and switching tabs swaps content without losing state.</done>
</task>

<task type="auto">
  <name>Task 2: Implement sticky timer header in Projects screen</name>
  <files>
    lib/ui/screens/projects_screen.dart
    lib/ui/widgets/timer_header.dart
    lib/state/timer_state.dart
    lib/state/timer_controller.dart
  </files>
  <action>
    Implement ProjectsScreen as a CustomScrollView with a pinned SliverPersistentHeader for a new TimerHeader widget and a SliverList for ProjectCard rows. TimerHeader should show active project name and running time, plus a quick start/stop control. If no timer is running, show the last active project name (or a fallback label) with 0.00h. Persist the last active project id in TimerState and update TimerController so it is set when timers stop or switch, without changing existing timer semantics. Use Riverpod select to minimize rebuilds for the header and list items.
  </action>
  <verify>flutter analyze</verify>
  <done>Timer header remains pinned while scrolling the project list and the header shows last active project when no timer is running.</done>
</task>

<task type="auto">
  <name>Task 3: Ensure non-blocking app startup for fast first frame</name>
  <files>
    lib/main.dart
  </files>
  <action>
    Audit main.dart to ensure runApp is called without awaiting any storage or controller initialization. If any async initialization exists before runApp, move it into lazy Riverpod providers or post-frame callbacks so the first frame renders immediately. Keep the initial UI lightweight: use const widgets where possible and avoid synchronous work in build methods that could delay the first frame.
  </action>
  <verify>flutter analyze</verify>
  <done>Cold start shows the Projects tab UI immediately and the app is responsive within ~2 seconds on a typical dev device or simulator.</done>
</task>

</tasks>

<verification>
- `flutter analyze`
- Manual sanity: open app, confirm header stays pinned and tabs switch between screens
</verification>

<success_criteria>
- Sticky timer header with quick control visible on Projects tab
- Bottom navigation provides Projects, Reports, Settings screens without nested scaffolds
</success_criteria>

<output>
After completion, create `.planning/phases/03-user-interface/03-01-SUMMARY.md`
</output>
